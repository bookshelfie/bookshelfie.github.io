<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Shelfie: The Bookshelf Search Engine</title>
        <meta name="description" content="How to make a Bookshelf Search Engine" />
        <meta name="author" content="Vinay Keerthi" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="stylesheet" href="static/font-awesome/4.7.0/css/font-awesome.css">
        <link rel="stylesheet" href="static/asciinema-player/2.4.1/asciinema-player.css">

        <link rel="stylesheet" href="static/revealjs/css/reset.css" />
        <link rel="stylesheet" href="static/revealjs/css/reveal.css" />
        <link rel="stylesheet" href="static/revealjs/css/theme/serif.css" id="theme" />
        <!-- Theme used for syntax highlighting of code -->
        <link rel="stylesheet" href="static/revealjs/lib/css/monokai.css" />
        <link rel="stylesheet" href="static/css/spl.css" />
        <!-- Printing and PDF exports -->
        <script>
            var link = document.createElement( 'link' );
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = window.location.search.match( /print-pdf/gi ) ? 'static/revealjs/css/print/pdf.css' : 'static/revealjs/css/print/paper.css';
            document.getElementsByTagName( 'head' )[0].appendChild( link );
        </script>
        <!--[if lt IE 9]>
        <script src="static/revealjs/lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>
        <div class="reveal">
            <!-- Any section element inside of this container is displayed as a slide -->
            <div class="slides">
                <section>
                    <div class="title image-container">
                        <h1 class="main-title">Shelfie</h1>
                        <h4 class="main-subtitle">
                            Building a Physical Inventory Search Engine</h4>
                    </div>
                    <p class='tiny' id="about-me">
                        Vinay Keerthi
                    </p>
                    <p class='tiny'>
                        Sr. Software Engineer, <i class="fa fa-cc-visa"></i><br />
                        PyCon India 2019 <br/>
                    </p>
                    <hr >
                    <div id="about-me-links">
                        <a href="https://gitlab.com/user/stonecharioteer">
                            <i class="fa fa-github fa-fw"></i> https://github.com/stonecharioteer
                        </a>
                        <a href="https://bookshelfie.github.io">
                            <i class="fa fa-book fa-fw"></i> https://bookshelfie.github.io
                        </a>
                        <a href="https://stonecharioteer.com">
                            <i class="fa fa-globe fa-fw"></i> https://stonecharioteer.com
                        </a>
                    </div>
                </section>
                <section id='intro'>
                    <section>
                        <h2>My bookshelf runs on Python</h2>
                        <img src="static/img/logo/python-powered-h.svg" height="300px">
                    </section>
                    <section class="fragments">
                        <a href="https://www.reddit.com/r/HolUp"><img src="static/img/memes/holdup.jpeg" /></a>
                        <p class="fragment">What do you <b>mean</b> your Bookshelf runs Python?</p>
                    </section>
                    <section>
                        <h4>Admission: I Own Over a 1000 Books</h4>
                        <div class="img-grid fragments">
                            <img class='bookshelves fragment' src="static/img/bookshelves/001.jpg" alt="">
                            <img class='bookshelves fragment' src="static/img/bookshelves/002.jpg" alt="">
                            <img class='bookshelves fragment' src="static/img/bookshelves/004.jpg" alt="">
                            <img class='bookshelves fragment' src="static/img/bookshelves/005.jpg" alt="">
                        </div>
                    </section>
                    <section class="fragments">
                        <h4>Seriously, it's hard to keep count.</h4>
                        <div class="img-grid fragment fragments">
                            <img class='bookshelves fragment' src="static/img/bookshelves/006.jpg" alt="">
                            <img class='bookshelves fragment' src="static/img/bookshelves/008.jpg" alt="">
                        </div>
                        <p class="fragment">And I'm not the most organized of people.</p>
                    </section>
                    <section>
                        <h4>But couldn't you just use one of the following:</h4>
                        <ul class="fragments">
                            <li class="fragment">Physical Notebooks: Too troublesome to carry</li>
                            <li class="fragment">Spreadsheets: Easy at first, too difficult to sync. <br /> Also <em>Google Sheets on the phone?</em> &#129326;
                                </li>
                            <li class="fragment">Goodreads: Annoying API. Seriously, Amazon, what the hell?</li>
                            <li class="fragment">LibraryThing: Free account has a limit of 250 books. Plus by this point I want the index to be local</li>
                        </ul>
                    </section>
                    <section>
                        <h4>I <b>also</b> own a lot of tech</b></h4>
                        <div class="fragments img-grid">
                            <img class="bookshelves fragment" src="static/img/clusterhat.jpg" alt="clusterhat"/>
                            <img class="bookshelves fragment" src="static/img/nodemcus.jpg" alt="clusterhat"/>
                            <img class="bookshelves fragment" src="static/img/ws2812b.jpg" alt="clusterhat"/>
                            <img class="bookshelves fragment" src="static/img/raspi.jpg" alt="clusterhat"/>
                        </div>
                        <p class="fragment">I think the AliExpress people know me well</p>
                    </section>
                    <section id="fragments">
                        <h4 class="fragments">I ended up with a <b>slightly</b> over-engineered solution</h4>
                        <span class="fragment">
                            <div class="logo-stack">
                                <img src="static/img/logo/python.svg" alt="Python Logo" class="logo major">
                                <img src="static/img/logo/micropython.png" alt="" class="logo major">
                                <img src="static/img/logo/mosquitto.png" alt="Mosquitto" class="logo">
                                <img src="static/img/logo/raspberry_pi.png" alt="Raspberry Pi Logo" class="logo major">
                                <img src="static/img/logo/postgresql.png" alt="Postgresql" class="logo">
                                <img src="static/img/logo/git.png" alt="Git" class="logo">
                                <img src="static/img/logo/debian.jpg" alt="debian" class="logo">
                            </div>
                        </span>
                    </section>
                    <section>
                        <h3>I built a <em>search engine</em> for my bookshelf, using RGB LEDs</h3>
                        <iframe width="560" height="315" src="https://www.youtube.com/embed/Gjc9Y9n9Y_I?autoplay=1&mute=1" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen muted></iframe>
                    </section>
                </section>
                <section id='micropython-rgb'>
                    <section>
                        <h2>Introduction to Micropython</h2>
                        <img src="static/img/logo/micropython.png" height="300" />
                    </section>
                    <section>
                        <h4>What is MicroPython?</h4>
                        <ul>
                            <li>Python for Microcontrollers</li>
                            <li><b>Seriously,</b> you can <em>run Python on tiny boards.</em></li>
                            <li>Tiny, includes a subset of CPython's libraries</li>
                            <li>Runs off chips with 8kB space and 128k RAM</li>
                        </ul>
                    </section>
                    <section>
                        <h4>Getting Started with MicroPython</h4>
                        <ul class="fragments">
                            <li class="fragment">Buy an ESP8266 or ESP32 Chip (Available on Amazon / AliExpress)</li>
                            <li class="fragment">Flash MicroPython firmware</li>
                            <li class="fragment">Profit???</li>
                        </ul>
                    </section>
                    <section>
                        <h4>ESP8266 (Nodemcu)</h4>
                        <div class='img-grid'>
                            <img src="static/img/hardware/esp8266_001.jpg" alt="ESP8266" class="bookshelves">
                            <img src="static/img/hardware/esp8266_003.jpg" alt="ESP8266" class="bookshelves">
                            <img src="static/img/hardware/nodemcu-spec.png" alt="ESP8266" class="bookshelves">
                        </div>
                    </section>
                    <section>
                        <h4>ESP8266 (Nodemcu)</h4>
                        <ul>
                            <li>Runs Lua out of the box</li>
                            <li>Can install MicroPython firmware</li>
                            <li>Supports WiFi</li>
                            <li>Has 128kB RAM and 4MB ROM</li>
                            <li>USB Interface</li>
                            <li>Costs between INR 140 to INR 400 (or around 3-4 Euros) depending on where you get it from.</li>
                        </ul>
                    </section>
                    <section>
                        <h4>Flashing MicroPython</h4>
                        <ul>
                            <li>Download Suitable Firmware</li>
                            <li>Setup Virtual Environment</li>
                            <li>Run <span class='code-snippet'>pip install esptool</span></li>
                            <li>Add current user to <span class="code-snippet">dialout</span> group (linux)</li>
                            <li>Flash firmware: <span class="code-snippet">$ esptool.py --port /dev/ttyUSB0 --baud 115200 write_flash --flash_size=detect 0 esp8266-20190529-v1.11.bin</span></li>
                        </ul>
                    </section>
                    <section>
                        <h4>Getting Up and Running</h4>
                        <img src="static/img/demos/esp8266-flash.gif" />
                        <!-- <asciinema-player
                            src="static/asciinema/flash_micropython.cast"
                            cols="170"
                            rows="20"
                            idle-time-limit="1"
                            speed="2"
                            font-size="16px">
                        </asciinema-player> -->
                    </section>
                    <section>
                        <h4>You Don't need to be Hackerman: Introducing the WebREPL</h4>
                        <ul>
                            <li>Use <span class='code-snippet'>picocom</span> to activate the webREPL.</li>
                            <li>Protip: <span class="code-snippet">screen /dev/ttyUSBx 115200</span> does the job better since it's easier to exit out of.</li>
                            <li>Connect to the ESP's WiFi</li>
                            <li>Use WebREPL to test out MicroPython</li>
                        </ul>
                    </section>
                    <section>
                        <h4>Activating the WebREPL</h4>
                        <img src="static/img/demos/esp8266-webrepl-activate.gif" />
                    </section>
                    <section>
                        <h4>Using the WebREPL</h4>
                        <img src="static/img/demos/esp8266-webrepl.gif" />

                    </section>
                    <section data-markdown>
                                ### Uploading Scripts using the webREPL CLI

                                ```
                                webrepl_cli.py -p PASSWORD local_file.py \
                                    IP:/destination.py
                                ```
                    </section>
                    <section>
                        <h4>Lifecycle of a MicroPython Program</h4>
                        <ul>
                            <li>Very similar to Arduino</li>
                            <li>First: <a href="https://github.com/bookshelfie/shelfie-micropython/blob/master/shelfie/boot.py"><i class="fa fa-link"></i></a><span class="code-snippet">boot.py</span></li>
                            <li>(optional) <span class='code-snippet'>webrepl_cfg.py</span></li>
                            <li>Finally: <a href="https://github.com/bookshelfie/shelfie-micropython/blob/master/shelfie/main.py"><i class="fa fa-link"></i></a><span class="code-snippet">main.py</span></li>
                        </ul>
                    </section>
                </section>
                <section id='communication'>
                    <section>
                        <h2>Shelfie</h2>
                        <img src="static/img/memes/mofo-snakes.jpeg" />
                    </section>
                    <section>
                        <h4>Hardware</h4>
                        <ul>
                            <li>ESP8266: 3 Nos.</li>
                            <li>Raspberry Pi 3B+: 1 Nos.</li>
                            <li>Raspberry Pi Zero W: 4 Nos.</li>
                            <li>Raspberry Pi Cluster Hat v2.2: 1 No.</li>
                            <li>WS2818B Addressable RGB LED Strips: 10 meter</li>
                        </ul>
                    </section>
                    <section>
                        <h4>Architecture</h4>
                        <div>
                            <img alt="Architecture diagram" src="static/img/arch.png" />
                        </div>
                    </section>
                    <section>
                        <h4>Communicating with the ESP8266: The MQTT Protocol</h4>
                        <ul>
                            <li>A Lightweight Protocol for <span class="code-snippet">&lt;buzzword&gt;IoT&lt;/buzzword&gt;</span></li>
                            <li>Message Queuing Telemetry Transport</li>
                            <li>Use Eclipse Mosquitto <a href="https://mosquitto.org/"><i class="fa fa-link"></i></a> for simplicity.</li>
                            <li>Use the <span class="code-snippet">mqtt</span> library in MicroPython, topics can be split using slashes.</li>
                        </ul>
                    </section>
                    <section>
                        <h4>MQTT Demo</h4>
                        <img src="static/img/mqtt-demo.gif" id="gif" alt="mqtt-demo">
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Shelfie Server</h2>
                        <h5>CRUD! He's used Flask</h5>
                    </section>
                    <section>
                        <h4>Flask</h4>
                        <ul>
                            <li>Lightweight and completely customizable.</li>
                            <li>Easy to hack around with, nothing is predetermined.</li>
                            <li>Simple is better than complex.</li>
                            <li>Explicit is better than implicit.</li>
                            <li><span class='code-snippet'>psycopg2 + flask_migrate + flask_sqlalchemy</span></li>
                        </ul>
                    </section>
                    <section>
                        <h4>DB Schema</h4>
                        <img src="static/img/db.png" />
                    </section>
                    <section>
                        <h4>UI with Flask-Admin</h4>
                        <img src="static/img/flask_admin.png" />
                    </section>
                    <section>
                        <h4>Indexing</h4>
                        <img src="static/img/flask_admin_entry.png" />
                    </section>
                    <section>
                        <h4>Position</h4>
                        <ul>
                            <li><span class="code-snippet">m:n.x</span>, where m = column start, n = column end, x = row.</li>
                            <li>Initial indexing is tedious, but I don't need to be organized later.</li>
                        </ul>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Alpha Stage Demos</h2>
                    </section>
                    <section>
                        <h4>Initial Troubles</h4>
                        <iframe width="860" height="520" data-src="https://www.youtube.com/embed/YBYUPO1rMCs?autoplay=1&loop=1&mute=1"></iframe>
                    </section>
                    <section>
                        <h4>What's Capacitance, Doc?</h4>
                        <iframe width="860" height="520" data-src="https://www.youtube.com/embed/_L4kOIKqMhc?autoplay=1&loop=1&mute=1"></iframe>
                    </section>
                    <section>
                        <h4>Improving Control</h4>
                        <iframe width="860" height="520" data-src="https://www.youtube.com/embed/5Yx_zzhiu6g?autoplay=1&loop=1&mute=1"></iframe>
                    </section>
                    <section>
                        <h4>Indexing Books</h4>
                        <iframe width="860" height="520" data-src="https://www.youtube.com/embed/6bydEXCtO5o?autoplay=1&loop=1"></iframe>
                    </section>
                    <section class="fragments">
                        <h4>The Prototype</h4>
                        <p class="fragment"><span class="code-snippet">curl -x GET http://server/api/v1/book/?title=the%20decline%20and%20fall</span></p>
                        <iframe class="fragment" width="860" height="520" data-src="https://www.youtube.com/embed/Gjc9Y9n9Y_I?autoplay=1&loop=1"></iframe>
                    </section>
                    <section class="fragments">
                        <h2>You <code>curl</code> for books? That's <em>boring!</em></h2>
                        <p class="fragment">Not <em>exactly.</em></p>
                        <p class="fragment">I said I wanted to <em>ask</em> my bookshelves for books.</p>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Shelfie Voice</h2>
                        <img src="static/img/memes/its-alive.jpeg">
                    </section>
                    <section class="fragments">
                        <h4 class="fragment">Enter Alexa</h4>
                        <img class="fragment" height="250px" src="static/img/logo/alexa.jpg" />
                    </section>
                    <section>
                        <h4>Building a Voice API with Flask</h4>
                        <ul>
                            <li><span class='code-snippet'>Flask_Ask</span> is a great extension that enables Alexa skills.</li>
                            <li>To run on a local server with access to the other API, use with <span class='code-snippet'>ngrok</span>.</li>
                            <li>Can also be configured on AWS, if you want to avoid buying a Raspberry Pi cluster. (Why would you do that?)</li>
                        </ul>
                    </section>
                    <section>
                        <h4>Code</h4>
                        <a href="https://github.com/bookshelfie/shelfie-voice/blob/master/shelfie_voice/extensions/ask.py" target="_blank"><img height="500px" src="static/img/flask_ask.png"></a>
                    </section>
                    <section>
                        <h4>Amazon Developer Page: Configuring The Skill</h4>
                        <img src="static/img/alexa_intent.png">
                    </section>
                    <section>
                        <h4>Amazon Developer Page: Configuring The Query Variable</h4>
                        <img src="static/img/intent_variable.png">
                        <p>Protip: When you want a raw string: use <span class='code-snippet'>AMAZON.SearchQuery</span></p>
                    </section>
                    <section>
                        <h4>Caveats</h4>
                        <ul>
                            <li>A bit slow, could work better on AWS native instead of my ngrok hack</li>
                            <li>Direct integration with the shelf server might be faster</li>
                            <li>Other libraries to consider: AWS's own library for Alexa.</li>
                            <li><span class='code-snippet'>Flask_Ask</span> is poorly packaged. Has dependencies locked to older versions of <span class='code-snippet'>cryptography</li>
                        </ul>
                    </section>
                </section>
                <section id="demo">
                    <section>
                        <h2>Now Presenting: Shelfie, The Bookshelf Search Engine</h2>
                    </section>
                    <section>
                        <h4>Finding a collection</h4>
                        <iframe width="860" height="520" data-src="https://www.youtube.com/embed/8A3bW81jVZ8?autoplay=1&loop=1"></iframe>
                    </section>
                    <section>
                        <h4>In your door! In your door, would you, could you, in the door?</h4>
                        <iframe width="860" class="fragment" height="520" data-src="https://www.youtube.com/embed/_TgDUx8aP8Q?autoplay=1&loop=1"></iframe>
                        <!-- <h4>Shelfie: Finding a Book When You Own 1500</h4>
                            <iframe width="860" height="520" data-src="https://www.youtube.com/embed/T3VgZJxRrww?autoplay=1&loop=1" frameborder="0" allowfullscreen></iframe> -->
                    </section>
                    <section class="fragments">
                        <h4>What if there are books <em>behind books</em>?</h4>
                        <p class="fragment">I'm glad you asked.</p>
                        <iframe width="860" class="fragment" height="520" data-src="https://www.youtube.com/embed/T41r5FyYdoI?autoplay=1&loop=1"></iframe>
                    </section>
                </section>
                <section>
                    <section class="fragments">
                        <h2>Future Upgrades</h2>
                        <h4 class="fragment">Improved Interfaces</h4>
                        <ul class="fragment">
                            <li>Web UI with flask_wtf</li>
                            <li>Telegram Bot</li>
                            <li>Bookshelf metrics: visualize read-count, days since last read stats with LEDs!</li>
                            <li>Dialogue flow for Alexa skills.</li>
                            <li>Use spacy for NLP</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Challenges to a MicroPython Project</h2>
                        <ul class="fragments">
                            <li class="fragment">Poor learning material</li>
                            <li class="fragment">No examples for best practises</li>
                            <li class="fragment">Need some competence with electronics.</li>
                            <li class="fragment">Procuring components (depends on location)</li>
                        </ul>
                    </section>
                </section>
                <section>
                        <h2>Links</h2>
                        <ul id="references">
                            <li><a href="https://github.com/micropython/webrepl">MicroPython WebREPL Repo</a></li>
                            <li><a href="https://circuitpython.org/">Circuit Python Documentation</a></li>
                            <li><a href="https://github.com/bookshelfie"><i class="fa fa-github"></i></a> Repositories</li>
                            <li><a href="https://stonecharioteer.gitlab.io/blog/snakes_on_a_bookshelf.html">Blogpost</a> detailing this project</li>
                            <li><a href="https://www.nodemcu.com/index_en.html">NodeMCU</a></li>
                            <li><a href="https://clusterhat.com/">Raspberry Pi Cluster Hat</a></li>
                            <li><a href="https://docs.micropython.org/en/latest/esp8266/quickref.html">MicroPython Documentation</a></li>
                            <li><a href="https://docs.micropython.org/en/latest/esp8266/tutorial/neopixel.html">NeoPixels Documentation</a></li>
                            <li><a href="https://www.eclipse.org/paho/">Paho MQTT Client</a></li>
                            <li><a href="https://mosquitto.org/">Eclipse Mosquitto Broker</a></li>
                            <li><a href="https://flask-ask.readthedocs.io/en/latest/">Flask-Ask</a> Alexa Library</li>
                            <li><a href="https://ngrok.com/">ngrok</a></li>
                            <li><a href="https://python-telegram-bot.org/">Telegram API</a></li>
                            <li><a href="https://asciinema.org/">Asciinema</a></li>
                            <li><a href="https://github.com/hakimel/reveal.js/">Reveal.js</a></li>
                        </ul>
                    </section>
                <section>
                    <h2>
                        Questions
                    </h2>
                    <p>
                        <i class='fa fa-twitter fa-fw'></i>
                        <a href="https://twitter.com/stonecharioteer">https://twitter.com/stonecharioteer</a><br />
                        <i class='fa fa-github fa-fw'></i>
                        <a href="https://github.com/stonecharioteer">https://github.com/stonecharioteer</a><br />
                        <i class='fa fa-github fa-fw'></i>
                        <a href="https://github.com/bookshelfie">https://github.com/bookshelfie</a><br />
                    </p>
                </section>

            </div>
        </div>
        <script src="static/revealjs/js/reveal.js"></script>
        <script src="static/asciinema-player/2.4.1/asciinema-player.js"></script>
        <script>
            // More info https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                controlsTutorial: true,
                controlsLayout: "bottom-right",
                controlsBackArrows: "faded",
                progress: true,
                center: true,
                hash: true,
                slideNumber: 'c/t',
                history: true,
                center: true,
                transition: 'slide', // none/fade/slide/convex/concave/zoom

                // More info https://github.com/hakimel/reveal.js#dependencies
                dependencies: [
                    { src: 'static/revealjs/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'static/revealjs/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'static/revealjs/plugin/highlight/highlight.js', async: true },
                    { src: 'static/revealjs/plugin/search/search.js', async: true },
                    { src: 'static/revealjs/plugin/zoom-js/zoom.js', async: true },
                    { src: 'static/revealjs/plugin/notes/notes.js', async: true }
                ]
            });

        </script>

    </body>
</html>
