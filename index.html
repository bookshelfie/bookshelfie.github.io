<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Shelfie: The Bookshelf Search Engine</title>
        <meta name="description" content="How to make a Bookshelf Search Engine" />
        <meta name="author" content="Vinay Keerthi" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="stylesheet" href="static/font-awesome/4.7.0/css/font-awesome.css">
        <link rel="stylesheet" href="static/asciinema-player/2.4.1/asciinema-player.css">

        <link rel="stylesheet" href="static/revealjs/css/reset.css" />
        <link rel="stylesheet" href="static/revealjs/css/reveal.css" />
        <link rel="stylesheet" href="static/revealjs/css/theme/serif.css" id="theme" />
        <!-- Theme used for syntax highlighting of code -->
        <link rel="stylesheet" href="static/revealjs/lib/css/monokai.css" />
        <link rel="stylesheet" href="static/css/spl.css" />
        <!-- Printing and PDF exports -->
        <script>
            var link = document.createElement( 'link' );
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = window.location.search.match( /print-pdf/gi ) ? 'static/revealjs/css/print/pdf.css' : 'static/revealjs/css/print/paper.css';
            document.getElementsByTagName( 'head' )[0].appendChild( link );
        </script>
        <!--[if lt IE 9]>
        <script src="static/revealjs/lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>
        <div class="reveal">
            <!-- Any section element inside of this container is displayed as a slide -->
            <div class="slides">
                <section>
                    <div class="title image-container">
                        <h1 class="main-title">Shelfie</h1>
                        <h4 class="main-subtitle">
                            Building a Physical Inventory Search Engine
                        </h4>
                        <p class="about-me">
                            Vinay Keerthi <br />
                        </p>
                        <p id="link"></p>
                    </div>
                    <aside class="notes">
                        Hello, I am Vinay Keerthi, and I am going to talk about Shelfie, a Micropython powered physical inventory search engine.
0                    </aside>
                </section>
                <section id='intro'>
                    <section>
                        <h2>My bookshelf runs on Python</h2>
                        <img src="static/img/logo/python-powered-h.svg" height="300px">
                        <aside class="notes">
                            Whenever I tell people that my bookshelf runs on Python, they stare at me.
                        </aside>
                    </section>
                    <section class="fragments">
                        <a href="https://www.reddit.com/r/HolUp"><img src="static/img/memes/holdup.jpeg" /></a>
                        <p class="fragment">What do you <b>mean</b> your Bookshelf runs Python?</p>
                        <aside class="notes">
                            They ask if I have way too much free time, or if I'm workaholic. Some of them say oh and go on their own way. Trust me, while
                            I was interviewing at other places before I joined Visa, I've had interviewers think I was just talking nonsense.
                        </aside>
                    </section>
                    <section>
                        <h4>Admission: I Own Over a 1000 Books</h4>
                        <div class="img-grid fragments">
                            <img class='bookshelves fragment' src="static/img/bookshelves/001.jpg" alt="">
                            <img class='bookshelves fragment' src="static/img/bookshelves/002.jpg" alt="">
                            <img class='bookshelves fragment' src="static/img/bookshelves/004.jpg" alt="">
                            <img class='bookshelves fragment' src="static/img/bookshelves/005.jpg" alt="">
                        </div>
                        <aside class="notes">
                            I'm rather proud of them. I grew up without many books, but I had a library card and used it everyday.
                        </aside>
                    </section>
                    <section class="fragments">
                        <h4>Seriously, it's hard to keep count.</h4>
                        <div class="img-grid fragment fragments">
                            <img class='bookshelves fragment' src="static/img/bookshelves/006.jpg" alt="">
                            <img class='bookshelves fragment' src="static/img/bookshelves/008.jpg" alt="">
                        </div>
                        <p class="fragment">And I'm not the most organized of people.</p>
                        <aside class="notes">
                            It becomes hard to count how many books you have sometimes. Once I crossed 250, I knew I had a problem
                            that would explode in my face some day.
                        </aside>
                    </section>
                    <section>
                        <h4>But couldn't you just use one of the following:</h4>
                        <ul class="fragments">
                            <li class="fragments fragment">Physical Notebooks<span class="fragment">: Too troublesome to carry</span></li>
                            <li class="fragments fragment">Spreadsheets<span class="fragment">: Easy at first, too difficult to sync. <br /> Also <em>Google Sheets on the phone?</em> &#129326;
                            </span></li>
                            <li class="fragments fragment">Goodreads<span class="fragment">: Annoying API. Seriously, Amazon, what the hell?</span></li>
                            <li class="fragments fragment">LibraryThing<span class="fragment">: Free account has a limit of 250 books. Plus by this point I want the index to be local</span></li>
                            <aside class="notes">
                                I've had people ask me to try each of these, and to be honest with you, I *have* tried them all.
                                I even had a distributed ledger. A friend and I had identical copies of a notebook that had a list of my books at one point.
                                Talk about blockchain, huh?
                            </aside>
                        </ul>
                    </section>
                    <section>
                        <h4>I <b>also</b> own a lot of tech</b></h4>
                        <div class="fragments img-grid spl">
                            <img class="bookshelves fragment spl" src="static/img/clusterhat.jpg" alt="clusterhat"/>
                            <img class="bookshelves fragment" src="static/img/nodemcus.jpg" alt="clusterhat"/>
                            <img class="bookshelves fragment" src="static/img/ws2812b.jpg" alt="clusterhat"/>
                            <img class="bookshelves fragment" src="static/img/raspi.jpg" alt="clusterhat"/>
                        </div>
                        <p class="fragment">I think the AliExpress people know me well</p>
                        <aside class="notes">
                            I first heard of the Rasbperry Pi while I was in college, but I couldn't afford one then.
                            After a few jobs, I decided to start buying a few of them. I now own 6 Rasbperry Pi 3B+, 6 Raspberry Pi Zero W and a whole bunch of
                            HATs for them. It's *so much fun*! But for a while, I did what everyone does with their Rasbperry Pi. I let it gather dust.
                        </aside>
                    </section>
                    <section id="fragments">
                        <h4 class="fragments">I ended up with a <b>slightly</b> over-engineered solution</h4>
                        <span class="fragment">
                            <div class="logo-stack">
                                <img src="static/img/logo/python.svg" alt="Python Logo" class="logo major">
                                <img src="static/img/logo/micropython.png" alt="" class="logo major">
                                <img src="static/img/logo/mosquitto.png" alt="Mosquitto" class="logo">
                                <img src="static/img/logo/raspberry_pi.png" alt="Raspberry Pi Logo" class="logo major">
                                <img src="static/img/logo/postgresql.png" alt="Postgresql" class="logo">
                                <img src="static/img/logo/git.png" alt="Git" class="logo">
                                <img src="static/img/logo/debian.jpg" alt="debian" class="logo">
                            </div>
                        </span>
                        <aside class="notes">
                            So I decided to solve my problem with my collection of electronics and my favourite language: Python!
                            You might say that the solution is a bit too IMBA for a home server.
                        </aside>
                    </section>
                    <section>
                        <h3>I built a <em>search engine</em> for my bookshelf, using RGB LEDs</h3>
                        <iframe width="560" height="315" src="https://www.youtube.com/embed/Gjc9Y9n9Y_I?mute=1" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen muted></iframe>
                        <aside class="notes">
                            What I mean to say is: I got some RGB LED strips, bought my first soldering iron, got burned once,
                            and managed to NOT set my house on fire, to build... this.
                        </aside>
                    </section>
                </section>
                <section id='micropython-rgb'>
                    <section>
                        <h2>Introduction to Micropython</h2>
                        <img src="static/img/logo/micropython.png" height="300" />
                        <aside class="notes">
                            The majority of this project runs on an amazing project called MicroPython.

                        </aside>
                    </section>
                    <section>
                        <h4>What is MicroPython?</h4>
                        <ul>
                            <li>Python for Microcontrollers</li>
                            <li><b>Seriously,</b> you can <em>run Python on tiny boards.</em></li>
                            <li>Tiny, includes a subset of CPython's libraries</li>
                        </ul>
                        <aside class="notes">
                            MicroPython is a tiny subset of Python, developed to target microcontrollers.
                            The language is syntactically similar to Python, you have the same paradigms, and you can do a lot of the same things.
                            It is just a more pythonic way to build an IoT project. No C knowledge required!
                        </aside>
                    </section>
                    <section>
                        <h4>Getting Started with MicroPython</h4>
                        <ul class="fragments">
                            <li class="fragment">Buy an ESP8266 or ESP32 based Chip (Available on Amazon / AliExpress)</li>
                            <li class="fragment">Flash MicroPython firmware</li>
                            <li class="fragment">Profit???</li>
                        </ul>
                        <aside class="notes">
                            It is very easy to get started with uPy. Just buy a nodemcu, flash the firmware and... then what?
                            Seriously, like I said, most Rasbperry Pi devices are gathering dust somewhere in some geek's table. So what makes uPy any different?
                            So many chips must be lying in dust.
                            But is it that difficult to make something in uPy?
                        </aside>
                    </section>
                    <section>
                        <h4>Nodemcu</h4>
                        <div class='img-grid'>
                            <img src="static/img/hardware/esp8266_001.jpg" alt="ESP8266" class="bookshelves">
                            <img src="static/img/hardware/esp8266_003.jpg" alt="ESP8266" class="bookshelves">
                            <img src="static/img/hardware/nodemcu-spec.png" alt="ESP8266" class="bookshelves">
                        </div>
                        <aside class="notes">
                            The nodemcu is a chip based on the ESP8266 WiFi SoC from Esperrif, a chinese company.
                            There are other chips you can buy, but the nodemcu is easiest to procure and the MicroPython firmware works quite well with it.
                        </aside>
                    </section>
                    <section>
                        <h4>Nodemcu</h4>
                        <ul>
                            <li>Based on the ESP8266 Wi-Fi SoC</li>
                            <li>Runs Lua out of the box</li>
                            <li>Can install MicroPython firmware</li>
                            <li>Supports WiFi (2GHz only)</li>
                            <li>Has 128kB RAM and 4MB ROM</li>
                            <li>USB Interface</li>
                            <li>Costs between INR 140 to INR 400 (or around 3-4 Euros) depending on where you get it from.</li>
                        </ul>
                        <aside class="notes">
                            It has nothing to do with node (thank god), and runs Lua out of the box.
                            It also has some General Purpose IO pins, which you can use to control a simple circuit. The pins on the chip deal with 3.5V electricity, and the chip can be powered by a 1A Mobile charger since it uses a uUSB port.
                        </aside>
                    </section>
                    <section>
                        <h4>Flashing MicroPython</h4>
                        <ul>
                            <li>Download Suitable Firmware</li>
                            <li>Setup Virtual Environment</li>
                            <li>Run <span class='code-snippet'>pip install esptool</span></li>
                            <li>Add current user to <span class="code-snippet">dialout</span> group (linux)</li>
                            <li>Flash firmware: <span class="code-snippet">$ esptool.py --port /dev/ttyUSB0 --baud 115200 write_flash --flash_size=detect 0 esp8266-20190529-v1.11.bin</span></li>
                        </ul>
                        <aside class="notes">
                            Wait wait, I've been saying *firmware* a whole lot. Do you have to do some sort of hackerman nonsense to get *Python* running? God I hope not.
                            Actually, the process for flashing MicroPython on one of these boards takes *seconds*.
                        </aside>
                    </section>
                    <section>
                        <h4>Getting Up and Running</h4>
                        <img src="static/img/demos/esp8266-flash.gif" />
                        <aside class="notes">
                            What, you don't believe me? Here's a gif showing you how long it takes.
                            You first make a venv, activate it, install the dependency, add yourself to the right group in linux, clear the memory of the board, then load the firmware.
                            And presto! You got yourself a python interpreter on a board that is so small, I carry one with me everywhere.
                        </aside>
                    </section>
                    <section>
                        <h4>You Don't need to be Hackerman: Introducing the WebREPL</h4>
                        <ul>
                            <li>Use <span class='code-snippet'>picocom</span> to activate the webREPL.</li>
                            <li>Protip: <span class="code-snippet">screen /dev/ttyUSBx 115200</span> does the job better since it's easier to exit out of.</li>
                            <li>Connect to the ESP's WiFi</li>
                            <li>Use WebREPL to test out MicroPython</li>
                        </ul>
                        <aside class="notes">
                            But again, I need to use the terminal?
                            Not quite. You can use a Web-based REPL.
                        </aside>
                    </section>
                    <section>
                        <h4>Activating the WebREPL</h4>
                        <img src="static/img/demos/esp8266-webrepl-activate.gif" />
                        <aside class="notes">
                            To activate it, you get onto the board by using screen, and import webrepl_setup, which asks you for a password.
                            Hmm, someone should send these guys a PR to mask the input.
                            Once you're done, you can git clone the webrepl repository and launch the html file from your browser.
                        </aside>
                    </section>
                    <section>
                        <h4>Using the WebREPL</h4>
                        <img src="static/img/demos/esp8266-webrepl.gif" />
                        <aside class="notes">
                            The webrepl gives you an interpreter, and also lets you upload and download files from it.
                            It makes it easy to debug stuff and you can write code on your favourite editor.
                            But if you want to use a terminal to upload the scripts into the nodemcu, then there's the CLI.
                            I like setting up the script as a git pre-commit hook.
                        </aside>
                    </section>
                    <section data-markdown>
                        ### Uploading Scripts using the webREPL CLI

                        ```
                        webrepl_cli.py -p PASSWORD local_file.py \
                            IP:/destination.py
                        ```
                    </section>
                    <section>
                        <h4>Lifecycle of a MicroPython Program</h4>
                        <ul>
                            <li>Very similar to Arduino</li>
                            <li>First: <a href="https://github.com/bookshelfie/shelfie-micropython/blob/master/shelfie/boot.py"><i class="fa fa-link"></i></a><span class="code-snippet">boot.py</span></li>
                            <li>(optional) <span class='code-snippet'>webrepl_cfg.py</span></li>
                            <li>Finally: <a href="https://github.com/bookshelfie/shelfie-micropython/blob/master/shelfie/main.py"><i class="fa fa-link"></i></a><span class="code-snippet">main.py</span></li>
                        </ul>
                        <aside class="notes">
                            If you've coded in Arduino before, this might be familiar to you. When your board "boots" up, it first executes a file named boot.py, and then it proceeds to run main.py. Of course any imports in boot.py will happen before main.
                            This is similar to the arduino world. Boot is executed everytime the chip wakes up, whether from no power or from deep sleep.
                            So you can do your configuration there. I use boot.py to connect to wifi, and to also read the config files.
                            main.py runs constantly. So this is where people usually use a while true loop. You can poll something, and you perform actions. Perhaps you put your chip in deep sleep.
                        </aside>
                    </section>
                </section>
                <section id='communication'>
                    <section>
                        <h2>Shelfie</h2>
                        <img src="static/img/memes/mofo-snakes.jpeg" />
                        <aside class="notes">
                            So that is how you get started with MicroPython. You now know more than I did when I decided to take
                            some of these nodemcus, strap together a few LED strips and pray to God that I didn't burn the house down
                            with a solder iron.
                        </aside>
                    </section>
                    <section>
                        <h4>Hardware</h4>
                        <ul>
                            <li>ESP8266: 3 Nos.</li>
                            <li>Raspberry Pi 3B+: 1 Nos.</li>
                            <li>Raspberry Pi Zero W: 4 Nos.</li>
                            <li>Raspberry Pi Cluster Hat v2.2: 1 No.</li>
                            <li>WS2812B Addressable RGB LED Strips: 10 meter</li>
                        </ul>
                        <aside class="notes">
                            What did I need to get started with this project: the following.
                        </aside>
                    </section>
                    <section>
                        <h4>Architecture</h4>
                        <div>
                            <img alt="Architecture diagram" src="static/img/arch.png" />
                        </div>
                        <aside class="notes">
                            Shelfie runs on the Raspberry Pi cluster hat. When I say Shelfie, there are several components.
                            The main component is a flask based web application running on the head node of my cluster.
                            This communicates with a postgres database, which stores all my data. This database is on one raspberry pi zero w.
                            The flask app also speaks to a mosquitto MQTT queue, which I'll talk about later. In simple terms, Mosquitto is a message queue
                            that sort of operates in the pub-sub model.
                            Then I plan to put all sorts of connected services on the other nodes of the Raspberry Pi cluster.
                            What services? Well, I'll tell you later.
                            The MicroPython bit runs on 3 nodemcu chips which are on the bookshelves. They are subscribed to 3 topics on the mosquitto server,
                            and perform actions based on those topics.
                        </aside>
                    </section>
                    <section>
                        <h4>Communicating with the ESP8266: The MQTT Protocol</h4>
                        <ul>
                            <li>A Lightweight Protocol for <span class="code-snippet">&lt;buzzword&gt;IoT&lt;/buzzword&gt;</span></li>
                            <li>Message Queuing Telemetry Transport</li>
                            <li>Use Eclipse Mosquitto <a href="https://mosquitto.org/"><i class="fa fa-link"></i></a> for simplicity.</li>
                            <li>Use the <span class="code-snippet">mqtt</span> library in MicroPython, topics can be split using slashes.</li>
                        </ul>
                        <aside class="notes">
                            MQTT is a lightweight protocol for message passing, made for IoT. It works on the publisher-subscriber model, and sits atop the TCP/IP protocol.
                            MQTT was first initialized in 1999 and has been used in several production grade applications. Hike messenger used MQTT for communication!
                        </aside>
                    </section>
                    <section>
                        <h4>MQTT Demo</h4>
                        <img src="static/img/mqtt-demo.gif" id="gif" alt="mqtt-demo">
                        <aside class="notes">
                            This is an example of how the nodemcu responds when I write a message to the topic it is subscribed to. I have 3 topics, labelled
                            according to the shelf. The chip, on receiving the payload processes it according to the topic, and responds, running a predetermined python function.
                        </aside>
                    </section>
                    <section>
                        <h4>WS2812B LED Strips</h4>
                        <img src="static/img/hardware/neopixel_circuit.png" />
                        <aside class="notes">
                            The WS2812B LED strips are amazing for use with projects like these. You'll find
                            resources that call these strips NeoPixels, because that is how they are usually
                            sold by hobby shops online. The NeoPixels have 3 inputs, one 3.3V, a ground and an input signal. So it can be controlled by a single input into the string,
                            passing an index indicating the LED that you want to highlight, and an RGB tuple.
                            The ESP outputs 5V so you'll have to use what is called a load shifter in your circuit.
                        </aside>
                    </section>
                    <section>
                        <h4>WS2812B LED Strips</h4>
                        <img src="static/img/hardware/neopixel_control_leds_micropython.png" />
                        <aside class="notes">
                            These strips can be easily controlled by the neopixel library in micropython.
                        </aside>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Shelfie Server</h2>
                        <h5>CRUD! He's used Flask</h5>
                        <aside class="notes">
                            I used flask for my web server. Why flask? I can explain.
                        </aside>
                    </section>
                    <section>
                        <h4>Flask</h4>
                        <ul>
                            <li>Lightweight and completely customizable.</li>
                            <li>Easy to hack around with, nothing is predetermined.</li>
                            <li>Simple is better than complex.</li>
                            <li>Explicit is better than implicit.</li>
                            <li><span class='code-snippet'>psycopg2 + flask_migrate + flask_sqlalchemy</span></li>
                        </ul>
                        <aside class="notes">
                            Flask shines in cases like this where you want just some particular features. Plus, there's thing I like to say. If you write flask with
                            care and make things super structured, it becomes Django in disguise.
                        </aside>
                    </section>
                    <section>
                        <h4>DB Table Schema</h4>
                        <img src="static/img/db.png" />
                        <aside class="notes">Where am I storing the data? Well, in a postgresql database. Right now, it is a simple table. This could have been on sqllite, but then again we're back to the why not use Excel question. The table does not use ISBNs as primary keys because I have a lot of books without the ISBN, some rare first edition books that were published before there was any system of numbering books. I also have fields to record the height and width of the books, but this is for a later feature that I have not yet implemented. The shelf denotes the label of the shelf, and subsequently the MQTT topic to listen to! The slots denote the number of the LEDs where the book have been placed.</aside>
                    </section>
                    <section>
                        <h4>UI with Flask-Admin</h4>
                        <img src="static/img/flask_admin.png" />
                        <aside class="notes">
                            The flask_admin extension makes it easy for me to check the database and make changes or additions.
                            Like all things to do with Flask, it is easy to customize.
                        </aside>
                    </section>
                    <section>
                        <h4>Indexing</h4>
                        <img src="static/img/flask_admin_entry.png" />
                        <aside class="notes">
                            With this, I don't need to make a GUI for entry or filtering. It's all here.
                        </aside>
                    </section>
                    <section>
                        <h4>Position</h4>
                        <ul>
                            <li><span class="code-snippet">m:n.x</span>, where m = column start, n = column end, x = row.</li>
                            <li>Indexing books the first time was difficult, but now I can place books anywhere and the bookshelf can remember them.</li>
                            <li>The shelf enables my lack of organization.</li>
                        </ul>
                        <aside class="notes">
                            The slots, or the positions are easy to explain. I use the following system. The message I send has the position in a string, using this system.
                            Some shelves have rows of books, i.e. there are books behind books. Some books are placed horizontally, some are thick so that they take more than one LED in side, and some are thin so you could have 4 to 5 books at a single spot.
                            Shelfie's system accounts for all of this. In fact this was my goal. I wanted a system of organization that assumes I am not organized. That assumes
                            that Marie Kondo would probably have a field day in my house.
                            Shelfie is my answer to that problem.
                        </aside>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Alpha Stage Demos</h2>
                        <aside class="notes">It's time for some demos of the alpha stage. I began work on Shelfie last year but the majority of the work on these bunch of videos I'm about to show you happened over a weekend. I spent most of my time debugging micropython, and I didn't have a MQTT queue back then, or a flask server. At the time I was considering writing my own webserver in micropython, naturally inspired by Flask. I've since realized that is a bad idea for various reasons.</aside>
                    </section>
                    <section>
                        <h4>Blink, blink</h4>
                        <iframe width="860" height="520" data-src="https://www.youtube.com/embed/YBYUPO1rMCs?loop=1&mute=1"></iframe>
                        <aside class="notes">The first time I blinked these LEDs was pure joy.</aside>
                    </section>
                    <section>
                        <h4>What's Capacitance, Doc?</h4>
                        <iframe width="860" height="520" data-src="https://www.youtube.com/embed/_L4kOIKqMhc?loop=1&mute=1"></iframe>
                        <aside class="notes">And almost instantly it stopped working. I asked a few friends, friends who are a lot smarter than I am, and once they finished laughing, they told me that I needed a capacitor and a resistor in my circuit. I admit, I did not fully understand any of that. I never paid attention in electronics class.</aside>
                    </section>
                    <section>
                        <h4>Improving Control</h4>
                        <iframe width="860" height="520" data-src="https://www.youtube.com/embed/5Yx_zzhiu6g?loop=1&mute=1"></iframe>
                        <aside class="class">
                            Once I had better control, I instantly wanted to make a game like snake. I wanted to connect this to a bootleg PS4 controller and have fun playing with it. With my voltage problems solved, I could do that.
                        </aside>
                    </section>
                    <section>
                        <h4>Indexing Books</h4>
                        <iframe width="860" height="520" data-src="https://www.youtube.com/embed/6bydEXCtO5o?loop=1"></iframe>
                        <aside class="notes">
                            I even came up with a way to help me count which LED I'm placing a book in. I simply highlight the 10th LEDs and count the tens. It is a simple hack,
                            but it works!
                        </aside>
                    </section>
                    <section class="fragments">
                        <h4>The Prototype</h4>
                        <p class="fragment"><span class="code-snippet">curl -x GET http://server/api/v1/book/?title=the%20decline%20and%20fall</span></p>
                        <iframe class="fragment" width="860" height="520" data-src="https://www.youtube.com/embed/Gjc9Y9n9Y_I?loop=1"></iframe>
                        <aside class="notes">Now back to the video you've seen before. I *curl* for a book with a given title, and the bookshelf responds by showing me where it is with LEDs.</aside>
                    </section>
                    <section class="fragments">
                        <h2>You <em><code class="fragment highlight-green">curl</code></em> for books?</h2>
                        <p class="fragment fade-in">That's <em>boring!</em></p>
                        <p class="fragment">Not <em>exactly.</em></p>
                        <p class="fragment fragments">I said I wanted to <em class="fragment highlight-red">ask</em> my bookshelves for books.</p>
                        <p class="fragment">So, I added another service.</p>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Shelfie Voice</h2>
                        <img src="static/img/memes/its-alive.jpeg">
                        <aside class="notes">This is where I do my Dr. Frankenstein laugh. I'm less of a Tony Stark and more of a Dr. Victor Frankenstein at this point</aside>
                    </section>
                    <section class="fragments">
                        <h4 class="fragment">Enter Alexa</h4>
                        <img class="fragment" height="250px" src="static/img/logo/alexa.svg" />
                        <aside class="notes">
                            I've evaluated 3 voice engines, and of them all, Alexa has proved to be the easiest to work with.
                            Although I have to admit, I want to try something else to make this entirely local.
                            The main problem with open source and locally hosted text to voice engines is the rendering.
                            Nothing beats Amazon or Google servers in that regard to natural tones. I mean, you should listen to what it can really do.
                        </aside>
                    </section>
                    <section>
                        <h4>Building a Voice API with Flask</h4>
                        <ul>
                            <li><span class='code-snippet'>Flask_Ask</span> is a great extension that enables Alexa skills.</li>
                            <li>To run on a local server with access to the other API, use with <span class='code-snippet'>ngrok</span>.</li>
                            <li>Can also be configured on AWS, if you want to avoid buying a Raspberry Pi cluster. (Why would you do that?)</li>
                        </ul>
                        <aside class="notes">
                            Unsurprisingly, there's an extension for flask that talks to Alexa's servers.
                            It works really well, and you can configure it on AWS as well. But I wanted to run it locally since it had to communicate with my other API.
                            And that went really well!
                        </aside>
                    </section>
                    <section>
                        <h4>Voice Server Architecture</h4>
                        <img src="static/img/arch-complete.png" />
                        <aside class="notes">
                            So now remember that architecture? This is the complete diagram as of today. I have an Alexa skill that talks to my main application.
                            And this is how the user uses Shelfie. They do not need to use a web UI, and god forbid I have to write any more CSS other than the CSS
                            I had to write for this presentation!
                        </aside>
                    </section>
                    <section>
                        <h4>Code</h4>
                        <a href="https://github.com/bookshelfie/shelfie-voice/blob/master/shelfie_voice/extensions/ask.py" target="_blank"><img height="500px" src="static/img/flask_ask.png"></a>
                        <aside class="notes">
                            The code is fairly simple. Alexa deals with what is called an intent. Depending on how you configure the online skill, alexa
                            asks your server for an intent so you need to provide them. This is done through the decorator. Note the intent name is BookFinderIntent.
                            Your function operates like a flask view, only you return a statement. Something for Alexa to respond with.
                            Given flasks async-less operation, this is actually a slow process btw.
                        </aside>
                    </section>
                    <section>
                        <h4>Amazon Developer Page: Configuring The Skill</h4>
                        <img src="static/img/alexa_intent.png">
                        <aside class="notes">
                            This is the page you get to configure your skill. The intent is named exactly the same here as well. It is case sensitive.
                            You get to configure the invoke phrase for your skill as well. In my case it is "ask my bookshelf", and this is triggered after I say "alexa".
                        </aside>
                    </section>
                    <section>
                        <h4>Amazon Developer Page: Configuring The Query Variable</h4>
                        <img src="static/img/intent_variable.png">
                        <p>Protip: When you want a raw string: use <span class='code-snippet'>AMAZON.SearchQuery</span></p>
                        <aside class="notes">
                            The query variable is the fun bit. This is what is passed as named argument to your function.
                            Yes, *named* keyword argument, so the name
                            you use here is the same name you have to use in the function. I'm stress on this because I messed it up and spent an hour debugging why book was None.
                            Also, the raw string thing.
                        </aside>
                    </section>
                    <section>
                        <h4>Caveats</h4>
                        <ul>
                            <li>A bit slow, could work better on AWS native instead of my ngrok hack</li>
                            <li>Direct integration with the shelf server might be faster</li>
                            <li>Other libraries to consider: AWS's own library for Alexa.</li>
                            <li><span class='code-snippet'>Flask_Ask</span> is poorly packaged. Has dependencies locked to older versions of <span class='code-snippet'>cryptography</li>
                        </ul>
                        <aside class="notes">
                            Running your own alexa skill locally relies on a lot of hacks. Suprisingly documented hacks. There are a lot of articles on this.
                        </aside>
                    </section>
                </section>
                <section id="demo">
                    <section>
                        <h2>Now Presenting: Shelfie, The Bookshelf Search Engine</h2>
                        <aside class="notes">Now you get the final result.</aside>
                    </section>
                    <section>
                        <h4>Finding a collection</h4>
                        <iframe width="860" height="520" data-src="https://www.youtube.com/embed/8A3bW81jVZ8?loop=1"></iframe>
                    </section>
                    <section>
                        <h4>In your door! In your door, would you, could you, in the door?</h4>
                        <iframe width="860" class="fragment" height="520" data-src="https://www.youtube.com/embed/_TgDUx8aP8Q?loop=1"></iframe>
                        <!-- <h4>Shelfie: Finding a Book When You Own 1500</h4>
                            <iframe width="860" height="520" data-src="https://www.youtube.com/embed/T3VgZJxRrww?loop=1" frameborder="0" allowfullscreen></iframe> -->
                    </section>
                    <section>
                        <h4>Finding a single book</h4>
                        <iframe width="860" height="520" data-src="https://www.youtube.com/embed/zp9BLR_rlHM?loop=1"></iframe>
                    </section>
                    <section class="fragments">
                        <h4>What if there are books <em>behind</em> books?</h4>
                        <p class="fragment">I'm glad you asked.</p>
                        <iframe width="860" class="fragment" height="520" data-src="https://www.youtube.com/embed/T41r5FyYdoI?loop=1"></iframe>
                    </section>
                </section>
                <section>
                    <section class="fragments">
                        <h2>Future Upgrades</h2>
                        <h4 class="fragment">Improved Interfaces</h4>
                        <ul class="fragment">
                            <li>Web UI with flask_wtf</li>
                            <li>Telegram Bot</li>
                            <li>Bookshelf metrics: visualize read-count, days since last read stats with LEDs!</li>
                            <li>Dialogue flow for Alexa skills.</li>
                            <li>Use spacy for NLP</li>
                        </ul>
                        <aside class="notes">
                            All of the work you saw in the last few slides, are features I have added over the last few weeks. The flask API took a day to write, and several days to improve. The micropython code took a few days to tweak into its current, productionized state. And the voice api took the better part of a day to write. The toughest parts were mostly the micropython and alexa bits. If you're writing a flask CRUD api, just google Miguel Grinberg and
                            you'll be up to speed in no time.
                            The features I want to add are a chatbot, so I can scan ISBNs and catalogue them. The telegram API is super sweet and sssh it's a Flask extension too.
                            I also want to write a web UI, even though I hate doing front end work.
                            I would love to do some analytics, which is why I'm contemplating a changes table to record where my books have been and read counts.
                            And most importantly, I want to use spacy for NLP so I can build dialogue with Alexa. I want connected, coherent responses, not the hack I have right
                            now.
                        </aside>
                    </section>
                    <section>
                        <h2>Challenges to a MicroPython Project</h2>
                        <ul class="fragments">
                            <li class="fragment">Poor learning material</li>
                            <li class="fragment">No examples for best practises</li>
                            <li class="fragment">Need some competence with electronics.</li>
                            <li class="fragment">Procuring components (depends on location)</li>
                        </ul>
                        <aside class="notes">
                            When I started this project 18 months ago, I did not know most of this stuff. I knew Python, flask and that micropython was a thing.
                            Things changed while doing this project, and I feel that the time I spent on it is a labour of love.
                            That being said, it was both easy and not easy.
                            I didn't find good material especially on the micropython end.
                            And I didn't find any impressive projects that people had made using it. Just a few hobby projects, but nothing... production grade.
                            That is why Shelfie has deployment scripts. It has systemctl files for the WSGI server sitting in front of the flask API and the alexa voice skill.
                            It uses a service for ngrok as well, and there's an nginx server that balances the load.
                            I did this because when I originally thought of Shelfie I didn't know coding. I was not a developer back then.
                        </aside>
                    </section>
                </section>
                <section>
                    <h2>Vinay Keerthi</h2>
                    <ul>
                        <li>Sr. Software Engineer @ Visa Inc.</li>
                        <li>@stonecharioteer</li>
                        <li><a href="https://stonecharioteer.com">stonecharioteer.com</a></li>
                        <li>github.com/stonecharioteer</li>
                        <li>github.com/bookshelfie</li>

                    </ul>
                    <aside class="notes">
                        This is the intro I said that will come at the end. I am Vinay Keerthi, and I am a self-taught programmer.
                        I did my undergrad in Mechanical Engineering. I have no formal training in Computer Science or electronics. In fact,
                        I hated studying electronics! <br />
                        After college, I worked as a Production Engineer at a plant that manufactured ignition coils
                        for motorcycles. While working there, I was in charge of the tools and we had an elaborate system of finding tools. But nothing
                        accounted for people putting tools in the wrong place. Everyone blamed the operators. I wondered why the system didn't allow disarray.
                        I had the same problem with my bookshelf. I would organize my shelves, and the moment I took a book out
                        and put it somewhere else, my system failed.
                        <br />That was not an easy system to use.
                        <br />I learnt Python in the years since and once I discovered MicroPython, I realized I could try something out.
                        <br />This is that something. Shelfie allows me to pick up a book and not have to put it back into a hardcoded spot. <br />One day I will say "Alexa, ask my bookshelf where I should keep this book", and my bookshelf will light up and say "here you go, that book will fit here. I'll remember where it is."
                        <br />
                        That day isn't too far off imo.
                        Thank you.
                    </aside>
                </section>
                <section>
                        <h2>Links</h2>
                        <ul id="references">
                            <li><a href="https://github.com/micropython/webrepl">MicroPython WebREPL Repo</a></li>
                            <li><a href="https://circuitpython.org/">Circuit Python Documentation</a></li>
                            <li><a href="https://github.com/bookshelfie"><i class="fa fa-github"></i></a> Repositories</li>
                            <li><a href="https://stonecharioteer.gitlab.io/blog/snakes_on_a_bookshelf.html">Blogpost</a> detailing this project</li>
                            <li><a href="https://www.nodemcu.com/index_en.html">NodeMCU</a></li>
                            <li><a href="https://clusterhat.com/">Raspberry Pi Cluster Hat</a></li>
                            <li><a href="https://docs.micropython.org/en/latest/esp8266/quickref.html">MicroPython Documentation</a></li>
                            <li><a href="https://docs.micropython.org/en/latest/esp8266/tutorial/neopixel.html">NeoPixels Documentation</a></li>
                            <li><a href="https://www.eclipse.org/paho/">Paho MQTT Client</a></li>
                            <li><a href="https://mosquitto.org/">Eclipse Mosquitto Broker</a></li>
                            <li><a href="https://flask-ask.readthedocs.io/en/latest/">Flask-Ask</a> Alexa Library</li>
                            <li><a href="https://ngrok.com/">ngrok</a></li>
                            <li><a href="https://python-telegram-bot.org/">Telegram API</a></li>
                            <li><a href="https://asciinema.org/">Asciinema</a></li>
                            <li><a href="https://github.com/hakimel/reveal.js/">Reveal.js</a></li>
                        </ul>
                    </section>
                <section>
                    <h2>
                        Questions
                    </h2>
                    <p>
                        <i class='fa fa-twitter fa-fw'></i>
                        <a href="https://twitter.com/stonecharioteer">https://twitter.com/stonecharioteer</a><br />
                        <i class='fa fa-github fa-fw'></i>
                        <a href="https://github.com/stonecharioteer">https://github.com/stonecharioteer</a><br />
                        <i class='fa fa-github fa-fw'></i>
                        <a href="https://github.com/bookshelfie">https://github.com/bookshelfie</a><br />
                    </p>
                </section>

            </div>
        </div>
        <script src="static/revealjs/js/reveal.js"></script>
        <script src="static/asciinema-player/2.4.1/asciinema-player.js"></script>
        <script>
            // More info https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                controlsTutorial: true,
                controlsLayout: "bottom-right",
                controlsBackArrows: "faded",
                progress: true,
                center: true,
                hash: true,
                slideNumber: 'c/t',
                history: true,
                center: true,
                transition: 'slide', // none/fade/slide/convex/concave/zoom

                // More info https://github.com/hakimel/reveal.js#dependencies
                dependencies: [
                    { src: 'static/revealjs/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'static/revealjs/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'static/revealjs/plugin/highlight/highlight.js', async: true },
                    { src: 'static/revealjs/plugin/search/search.js', async: true },
                    { src: 'static/revealjs/plugin/zoom-js/zoom.js', async: true },
                    { src: 'static/revealjs/plugin/notes/notes.js', async: true }
                ]
            });

        </script>
        <script>
            var link = window.location.origin;
            if ((link.indexOf("github") == -1) & (link.indexOf("gitlab") == -1)) {
                link = "https://bookshelfie.github.io"
            }
            document.getElementById("link").innerHTML = `<a href="${link}"><i class="fa fa-book fa-fw"></i> ${link}</a>`
        </script>

    </body>
</html>
